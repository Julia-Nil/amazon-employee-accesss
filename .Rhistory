library(vroom)
library(lubridate)
library(tidyverse)
install.packages("discrim")
library(vroom)
library(lubridate)
library(tidyverse)
library(tidymodels)
library(recipes)
library(embed)
library(dials)
library(kknn)
library(discrim)
amazontrain <- vroom("C:/Users/julia/OneDrive - Brigham Young University/Desktop/stat 348/amazon-employee-access/amazon-employee-access-challenge/train.csv")
amazontrain <- amazontrain %>% mutate(ACTION = factor(ACTION))
amazontest <- vroom("C:/Users/julia/OneDrive - Brigham Young University/Desktop/stat 348/amazon-employee-access/amazon-employee-access-challenge/test.csv")
id_cols <- c("RESOURCE","MGR_ID","ROLE_ROLLUP_1","ROLE_ROLLUP_2",
"ROLE_DEPTNAME","ROLE_TITLE","ROLE_FAMILY_DESC",
"ROLE_FAMILY","ROLE_CODE")
amazontrain <- amazontrain %>% mutate(across(all_of(id_cols), as.factor))
amazontest  <- amazontest  %>% mutate(across(all_of(id_cols), as.factor))
amazontrain <- amazontrain %>%
mutate_if(is.character, as.factor) %>%   # convert text to factors
mutate_if(is.numeric, as.factor)         # convert IDs to factors if they’re really categories
amazonrecipetrain <- recipe(ACTION ~ ., data = amazontrain) %>%
step_other(all_nominal_predictors(), threshold = 0.01) %>%
step_unknown(all_nominal_predictors()) %>%        # handles unseen test levels
step_lencode_mixed(all_nominal_predictors(), outcome = vars(ACTION))
amazon_nb_model <- naive_Bayes(Laplace=tune(), smoothness=tune()) %>%
set_mode("classification") %>%
set_engine("naivebayes")
nb_wf <- workflow() %>%
add_recipe(amazonrecipetrain) %>%
add_model(amazon_nb_model)
final_wf <- nb_wf %>%
fit(data=amazontrain)
install.packages("naivebayes")
final_wf <- nb_wf %>%
fit(data=amazontrain)
folds <- vfold_cv(amazontrain, v=5)
tuning_grid <- grid_regular(penalty(), mixture(), levels=5)
CV_results <- tune_grid(
amazon_wf,
resamples = folds,
grid = tuning_grid,
metrics = metric_set(roc_auc)
)
folds <- vfold_cv(amazontrain, v=5)
tuning_grid <- grid_regular(Laplace(), smoothness(), levels=5)
CV_results <- tune_grid(
nb_wf,
resamples = folds,
grid = tuning_grid,
metrics = metric_set(roc_auc)
)
best_params <- select_best(CV_results, metric="roc_auc")
final_wf <- nb_wf %>%
finalize_workflow(best_params) %>%
fit(data=amazontrain)
preds <- predict(final_wf, new_data=amazontest, type = "prob") %>%
rename(ACTION=.pred_1)
results <- tibble(id = amazontest$id, ACTION = preds$ACTION)
vroom_write(results,
"C:/Users/julia/OneDrive - Brigham Young University/Desktop/stat 348/amazon-employee-access/knnresults.csv",
delim = ",")
results <- tibble(id = amazontest$id, ACTION = preds$ACTION)
vroom_write(results,
"C:/Users/julia/OneDrive - Brigham Young University/Desktop/stat 348/amazon-employee-access/nbresults.csv",
delim = ",")
install.packages(c("keras", "reticulate"))
library(vroom)
library(lubridate)
library(tidyverse)
library(tidymodels)
library(recipes)
library(embed)
library(dials)
library(kknn)
library(discrim)
library(reticulate)
library(keras)
amazontrain <- vroom("C:/Users/julia/OneDrive - Brigham Young University/Desktop/stat 348/amazon-employee-access/amazon-employee-access-challenge/train.csv")
amazontrain <- amazontrain %>% mutate(ACTION = factor(ACTION))
amazontest <- vroom("C:/Users/julia/OneDrive - Brigham Young University/Desktop/stat 348/amazon-employee-access/amazon-employee-access-challenge/test.csv")
id_cols <- c("RESOURCE","MGR_ID","ROLE_ROLLUP_1","ROLE_ROLLUP_2",
"ROLE_DEPTNAME","ROLE_TITLE","ROLE_FAMILY_DESC",
"ROLE_FAMILY","ROLE_CODE")
amazontrain <- amazontrain %>% mutate(across(all_of(id_cols), as.factor))
amazontest  <- amazontest  %>% mutate(across(all_of(id_cols), as.factor))
amazontrain <- amazontrain %>%
mutate_if(is.character, as.factor) %>%   # convert text to factors
mutate_if(is.numeric, as.factor)         # convert IDs to factors if they’re really categories
NNrecipe <- recipe(ACTION ~ ., data = amazontrain) %>%
update_role(id, new_role="id")
colnames
colnames()
names()
names(amazontrain)
id_cols <- c("RESOURCE","MGR_ID","ROLE_ROLLUP_1","ROLE_ROLLUP_2",
"ROLE_DEPTNAME","ROLE_TITLE","ROLE_FAMILY_DESC",
"ROLE_FAMILY","ROLE_CODE")
amazontrain <- amazontrain %>% mutate(across(all_of(id_cols), as.factor))
amazontest  <- amazontest  %>% mutate(across(all_of(id_cols), as.factor))
amazontrain <- amazontrain %>%
mutate_if(is.character, as.factor) %>%   # convert text to factors
mutate_if(is.numeric, as.factor)         # convert IDs to factors if they’re really categories
NNrecipe <- recipe(ACTION ~ ., data = amazontrain) %>%
update_role(ROLE_CODE, new_role="id")
step_other(all_nominal_predictors(), threshold = 0.01) %>%
step_unknown(all_nominal_predictors()) %>%        # handles unseen test levels
step_lencode_mixed(all_nominal_predictors(), outcome = vars(ACTION))
id_cols <- c("RESOURCE","MGR_ID","ROLE_ROLLUP_1","ROLE_ROLLUP_2",
"ROLE_DEPTNAME","ROLE_TITLE","ROLE_FAMILY_DESC",
"ROLE_FAMILY","ROLE_CODE")
amazontrain <- amazontrain %>% mutate(across(all_of(id_cols), as.factor))
amazontest  <- amazontest  %>% mutate(across(all_of(id_cols), as.factor))
amazontrain <- amazontrain %>%
mutate_if(is.character, as.factor) %>%   # convert text to factors
mutate_if(is.numeric, as.factor)         # convert IDs to factors if they’re really categories
NNrecipe <- recipe(ACTION ~ ., data = amazontrain) %>%
update_role(ROLE_CODE, new_role = "id") %>%
step_other(all_nominal_predictors(), threshold = 0.01) %>%
step_unknown(all_nominal_predictors()) %>%        # handles unseen test levels
step_lencode_mixed(all_nominal_predictors(), outcome = vars(ACTION)) %>%
step_range(all_numeric_predictors(), min = 0, max = 1)
amazon_nn_model <- mlp(hidden_units=tune(),
epochs=50) %>%
set_engine("keras") %>%
set_mode("classification")
nn_tunegrid <- grid_regular(hidden_units(range=c(1,maxHiddenUnits)),
levels=2)
maxHiddenUnits <- 10   # or however many you want to try
nn_tunegrid <- grid_regular(
hidden_units(range = c(1, maxHiddenUnits)),
levels = 2
)
nn_tunegrid <- grid_regular(hidden_units(range=c(1,maxHiddenUnits)),
levels=2)
nn_wf <- workflow() %>%
add_recipe(NNrecipe) %>%
add_model(amazon_nn_model)
folds <- vfold_cv(amazontrain, v=5)
tuning_grid <- grid_regular(Laplace(), smoothness(), levels=5)
CV_results <- tune_grid(
nn_wf,
resamples = folds,
grid = tuning_grid,
metrics = metric_set(roc_auc)
)
folds <- vfold_cv(amazontrain, v=5)
tuning_grid <- grid_regular(hidden_units(), penalty(), levels = 5)
CV_results <- tune_grid(
nn_wf,
resamples = folds,
grid = tuning_grid,
metrics = metric_set(roc_auc)
)
nn_model <-
mlp(hidden_units = tune(), penalty = tune()) %>%
set_engine("nnet") %>%
set_mode("classification")
maxHiddenUnits <- 10   # or however many you want to try
nn_tunegrid <- grid_regular(
hidden_units(range = c(1, maxHiddenUnits)),
levels = 2
)
nn_tunegrid <- grid_regular(hidden_units(range=c(1,maxHiddenUnits)),
levels=2)
nn_wf <- workflow() %>%
add_recipe(NNrecipe) %>%
add_model(amazon_nn_model)
folds <- vfold_cv(amazontrain, v=5)
tuning_grid <- grid_regular(hidden_units(), penalty(), levels = 5)
CV_results <- tune_grid(
nn_wf,
resamples = folds,
grid = tuning_grid,
metrics = metric_set(roc_auc)
)
folds <- vfold_cv(amazontrain, v = 5)
tuning_grid <- grid_regular(hidden_units(), penalty(), levels = 5)
CV_results <- tune_grid(
nn_wf,
resamples = folds,
grid = tuning_grid,
metrics = metric_set(roc_auc)
)
library(vroom)
library(lubridate)
library(tidyverse)
library(tidymodels)
library(recipes)
library(embed)
library(dials)
library(kknn)
library(discrim)
library(reticulate)
library(keras)
amazontrain <- vroom("C:/Users/julia/OneDrive - Brigham Young University/Desktop/stat 348/amazon-employee-access/amazon-employee-access-challenge/train.csv")
amazontrain <- amazontrain %>% mutate(ACTION = factor(ACTION))
amazontest <- vroom("C:/Users/julia/OneDrive - Brigham Young University/Desktop/stat 348/amazon-employee-access/amazon-employee-access-challenge/test.csv")
id_cols <- c("RESOURCE","MGR_ID","ROLE_ROLLUP_1","ROLE_ROLLUP_2",
"ROLE_DEPTNAME","ROLE_TITLE","ROLE_FAMILY_DESC",
"ROLE_FAMILY","ROLE_CODE")
amazontrain <- amazontrain %>% mutate(across(all_of(id_cols), as.factor))
amazontest  <- amazontest  %>% mutate(across(all_of(id_cols), as.factor))
amazontrain <- amazontrain %>%
mutate_if(is.character, as.factor) %>%   # convert text to factors
mutate_if(is.numeric, as.factor)         # convert IDs to factors if they’re really categories
NNrecipe <- recipe(ACTION ~ ., data = amazontrain) %>%
update_role(ROLE_CODE, new_role = "id") %>%
step_other(all_nominal_predictors(), threshold = 0.01) %>%
step_unknown(all_nominal_predictors()) %>%        # handles unseen test levels
step_lencode_mixed(all_nominal_predictors(), outcome = vars(ACTION)) %>%
step_range(all_numeric_predictors(), min = 0, max = 1)
nn_model <-
mlp(hidden_units = tune(), penalty = tune()) %>%
set_engine("nnet") %>%
set_mode("classification")
maxHiddenUnits <- 10   # or however many you want to try
nn_tunegrid <- grid_regular(
hidden_units(range = c(1, maxHiddenUnits)),
levels = 2
)
nn_tunegrid <- grid_regular(hidden_units(range=c(1,maxHiddenUnits)),
levels=2)
nn_wf <- workflow() %>%
add_model(nn_model) %>%
add_recipe(NNrecipe)
folds <- vfold_cv(amazontrain, v = 5)
tuning_grid <- grid_regular(hidden_units(), penalty(), levels = 5)
CV_results <- tune_grid(
nn_wf,
resamples = folds,
grid = tuning_grid,
metrics = metric_set(roc_auc)
)
best_params <- select_best(CV_results, metric = "roc_auc")
